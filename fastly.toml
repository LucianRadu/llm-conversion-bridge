#
# ADOBE CONFIDENTIAL
# ___________________
# Copyright 2025 Adobe
# All Rights Reserved.
# NOTICE: All information contained herein is, and remains
# the property of Adobe and its suppliers, if any. The intellectual
# and technical concepts contained herein are proprietary to Adobe
# and its suppliers and are protected by all applicable intellectual
# property laws, including trade secret and copyright laws.
#  Dissemination of this information or reproduction of this material
# is strictly forbidden unless prior written permission is obtained
# from Adobe.
#

# This file describes a Fastly Compute package. To learn more visit:
# https://www.fastly.com/documentation/reference/compute/fastly-toml

name = "llm-conversion-bridge"
description = "LLM Conversion Bridge - MCP server running on Fastly Compute (TypeScript)"
authors = ["Adobe"]
language = "javascript"
manifest_version = 3

[backends]
  [backends.ims-prod]
    url = "https://ims-na1.adobelogin.com/"
    override_host = "ims-na1.adobelogin.com"

  [backends.ims-stage]
    url = "https://ims-na1-stg1.adobelogin.com/"
    override_host = "ims-na1-stg1.adobelogin.com"

  [backends.aem-author-stage]
    url = "https://author-p77504-e175976-cmstg.adobeaemcloud.com/"
    override_host = "author-p77504-e175976-cmstg.adobeaemcloud.com"

[compute]
  # We are using the new JS-Compute runtime
  [compute.javascript]

[local_server]
  enableStreamingFetch = true
  [local_server.backends]
    [local_server.backends.ims-prod]
      url = "https://ims-na1.adobelogin.com/"
      override_host = "ims-na1.adobelogin.com"

    [local_server.backends.ims-stage]
      url = "https://ims-na1-stg1.adobelogin.com/"
      override_host = "ims-na1-stg1.adobelogin.com"

    [local_server.backends.aem-author-stage]
      url = "https://author-p77504-e175976-cmstg.adobeaemcloud.com/"
      override_host = "author-p77504-e175976-cmstg.adobeaemcloud.com"

[scripts]
  # The build script to run before deploying.
  build = "npm run build:fastly"

[env]
  # === STAGE ENVIRONMENT (for testing) ===
  PUBLISH_BASE_URL = "https://author-p77504-e175976-cmstg.adobeaemcloud.com"
  # PUBLISH_FASTLY_BACKEND not set - uses dynamic backend resolution
  IMS_FASTLY_BACKEND = "ims-stage"
  
  # === PRODUCTION ENVIRONMENT ===
  # PUBLISH_BASE_URL = "https://publish-p148639-e1512661.adobeaemcloud.com"
  # IMS_FASTLY_BACKEND = "ims-prod"
